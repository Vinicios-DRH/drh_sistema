{% extends 'base.html' %}

{% block title %}C√°lculo de Impacto Financeiro - Promo√ß√£o e Retroativo{% endblock %}
{% block head %}
<style>
    .transparent-card {
        background-color: rgba(255, 255, 255, 0.8);
        /* Fundo branco com 80% de opacidade */
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        /* Adiciona um leve sombreado */
    }

    .modal-xl {
        max-width: 95% !important;
    }

    #resultadoModal h6 {
        margin-top: 2rem;
        padding-top: 0.5rem;
        line-height: 1.4;
    }

    .modal-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #0d6efd;
        border-left: 5px solid #0d6efd;
        padding-left: 10px;
        margin-top: 2rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .modal-section-title i {
        font-size: 1.2rem;
    }

    .list-group-item strong {
        font-weight: 500;
    }

    .text-success-total {
        font-size: 1.5rem;
        font-weight: bold;
        color: #198754;
    }
</style>
{% endblock %}
{% block body %}
<section class="py-4" style="background: #f4f4f4; min-height: 100vh;">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="card shadow-sm rounded-3">
                    <div class="card-body">
                        <h3 class="text-center mb-4">C√°lculo de Impacto Financeiro - Promo√ß√£o e Retroativo</h3>
                        <form method="POST">
                            {{ form.hidden_tag() }}

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.data_inicio.label(class="form-label") }}
                                    {{ form.data_inicio(class="form-control") }}
                                </div>
                                <div class="col-md-6">
                                    {{ form.data_fim.label(class="form-label") }}
                                    {{ form.data_fim(class="form-control") }}
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.posto_origem.label(class="form-label") }}
                                    {{ form.posto_origem(class="form-select") }}
                                </div>
                                <div class="col-md-6">
                                    {{ form.posto_destino.label(class="form-label") }}
                                    {{ form.posto_destino(class="form-select") }}
                                </div>
                            </div>

                            <div class="mb-3">
                                {{ form.efetivo.label(class="form-label") }}
                                {{ form.efetivo(class="form-control") }}
                            </div>

                            <div class="d-grid mt-4">
                                {{ form.submit(class="btn btn-primary btn-lg") }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% if resultado %}
<!-- Modal -->
<div class="modal fade" id="resultadoModal" tabindex="-1" aria-labelledby="resultadoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl modal-dialog-centered">
        <div class="modal-content border-primary">
            <div class="modal-header">
                <h5 class="modal-title" id="resultadoModalLabel">üìä C√°lculo de Impacto - Promo√ß√£o e Retroativo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">

                <p><strong>Tabela utilizada:</strong> {{ tabela_usada.nome }} ({{
                    tabela_usada.data_inicio.strftime('%d/%m/%Y') }} a {{ tabela_usada.data_fim.strftime('%d/%m/%Y') }})
                </p>
                <hr>

                <ul class="list-group list-group-flush">
                    <li class="list-group-item">üí∞ <strong>Diferen√ßa por militar:</strong> R$ {{ resultado.diferenca |
                        br_currency }}</li>
                    <li class="list-group-item">üíµ <strong>Impacto Bruto Mensal:</strong> R$ {{ resultado.impacto_mensal
                        | br_currency }}</li>
                </ul>

                <h6 class="mt-4">üìÖ Impacto nos Dias Restantes</h6>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">üìÜ Impacto dos dias: R$ {{ resultado.impacto_dias | br_currency }}</li>
                    <li class="list-group-item">üèñÔ∏è 1/3 F√©rias (dias): R$ {{ resultado.ferias_dias | br_currency }}</li>
                    <li class="list-group-item">üéÅ 13¬∫ proporcional (dias): R$ {{ resultado.decimo_dias | br_currency }}
                    </li>
                </ul>

                <h6 class="mt-4">üìÜ Impacto nos Meses Restantes</h6>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">üìÖ Impacto dos meses: R$ {{ resultado.impacto_meses | br_currency }}
                    </li>
                    <li class="list-group-item">üèñÔ∏è 1/3 F√©rias (meses): R$ {{ resultado.ferias_meses | br_currency }}
                    </li>
                    <li class="list-group-item">üéÅ 13¬∫ proporcional (meses): R$ {{ resultado.decimo_meses | br_currency
                        }}
                    </li>
                </ul>

                <h5 class="mt-4 text-success text-end">‚úÖ Total Geral: R$ {{ resultado.total | br_currency }}</h5>

            </div>
            <div class="modal-footer">
                <a href="{{ url_for('baixar_pdf') }}" class="btn btn-outline-primary">
                    üì• Baixar PDF
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('show_modal') === '1') {
            const resultadoModal = new bootstrap.Modal(document.getElementById('resultadoModal'));
            resultadoModal.show();
        }
    });
</script>


{% endblock %}