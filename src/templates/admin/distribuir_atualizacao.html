{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<style>
  .kpi-card { border:1px solid rgba(0,0,0,.08); border-radius:14px; box-shadow:0 10px 24px rgba(0,0,0,.08); }
  .kpi-card .title { font-size:.85rem; color:#64748b; }
  .kpi-card .value { font-size:1.6rem; font-weight:700; }
  .progress { height:10px; }
</style>
{% endblock %}

{% block body %}
<section class="container py-4">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <h1 class="h5 m-0"><i class="bi bi-diagram-3 me-1"></i> Distribuição de Atualização — Cadetes</h1>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('home') }}"><i class="bi bi-house-door me-1"></i> Início</a>
  </div>

  <div class="row g-3">
    <div class="col-6 col-md-3">
      <div class="card p-3 kpi-card">
        <div class="title">Cadetes</div>
        <div class="value">{{ tot_cadetes }}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3 kpi-card">
        <div class="title">Militares elegíveis</div>
        <div class="value">{{ tot_alvos }}</div>
        <div class="small text-muted">~{{ estim_por_cadete }} por cadete (estimativa)</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3 kpi-card">
        <div class="title">Tarefas existentes</div>
        <div class="value">{{ tot_tarefas }}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3 kpi-card">
        <div class="title">Pendentes / Em edição</div>
        <div class="value">{{ tarefas_pend }}</div>
      </div>
    </div>
  </div>

  <form class="card p-3 mt-3" method="POST" onsubmit="return confirm('Confirmar a distribuição agora?');">
    {{ form.csrf_token }}

    <div class="row g-2 align-items-end">
      <div class="col-12 col-md-6">
        <label class="form-label">{{ form.limpeza.label.text }}</label>
        {{ form.limpeza(class="form-select") }}
        {% if form.limpeza.errors %}
          <div class="invalid-feedback d-block">
            {% for e in form.limpeza.errors %}{{ e }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-12 col-md-6 d-flex gap-2 mt-2 mt-md-0">
        {{ form.submit(class="btn btn-primary") }}
        <a class="btn btn-outline-secondary" href="{{ url_for('home') }}">Cancelar</a>
      </div>
    </div>

    <div class="mt-3 small text-muted">
      <ul class="mb-0">
        <li><strong>Nenhuma</strong>: cria apenas pares cadete–militar que ainda não existem.</li>
        <li><strong>Remover pendentes/em edição</strong>: apaga apenas tarefas não concluídas e redistribui.</li>
        <li><strong>Todas</strong>: apaga todas as tarefas (incluindo concluídas) e redistribui do zero.</li>
      </ul>
    </div>
  </form>
</section>
{% endblock %}
