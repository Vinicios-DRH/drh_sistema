{% extends 'base.html' %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}


{% block body %}
<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Alunos Cadastrados</h4>
        </div>
        <div class="card-body table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Foto</th>
                        <th>Nome Completo</th>
                        <th>Pelotão</th>
                        <th>Idade</th>
                        <th>Classificação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aluno in alunos %}
                    <tr>
                        <td>
                            <img src="{{ url_for('static', filename=aluno.foto) if aluno.foto else url_for('static', filename='img/avatar-default.png') }}"
                                class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">
                        </td>
                        <td>
                            <a href="{{ url_for('ficha_detalhada', aluno_id=aluno.id) }}"
                                class="text-decoration-none fw-semibold">
                                {{ aluno.nome_completo }}
                            </a>
                        </td>
                        <td>{{ aluno.pelotao or '-' }}</td>
                        <td>{{ aluno.idade_atual or '-' }}</td>
                        <td>{{ aluno.classificacao_final_concurso or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


<div class="row my-4">
    <div class="col-md-6 mb-4">
        <div class="card shadow">
            <div class="card-header bg-info text-white">Distribuição por Idade</div>
            <div class="card-body">
                <canvas id="idadeChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-4">
        <div class="card shadow">
            <div class="card-header bg-success text-white">Categorias da CNH</div>
            <div class="card-body">
                <canvas id="cnhChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-12 mb-4">
        <div class="card shadow">
            <div class="card-header bg-secondary text-white">Estado Civil</div>
            <div class="card-body">
                <canvas id="estadoCivilChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // Gráfico de Idade
    const idadeCtx = document.getElementById('idadeChart');
    new Chart(idadeCtx, {
        type: 'bar',
        data: {
            labels: {{ idade_chart.keys() | list | tojson }},
        datasets: [{
            label: 'Quantidade',
            data: {{ idade_chart.values() | list | tojson }},
        backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }]
        },
        options: {
        responsive: true,
        plugins: { legend: { display: false } }
    }
    });

    // Gráfico de CNH
    const cnhCtx = document.getElementById('cnhChart');
    new Chart(cnhCtx, {
        type: 'pie',
        data: {
            labels: {{ cnh_chart.keys() | list | tojson }},
        datasets: [{
            data: {{ cnh_chart.values() | list | tojson }},
        backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6c757d']
            }]
        },
        options: {
        responsive: true
    }
    });

    // Gráfico de Estado Civil
    const estadoCivilCtx = document.getElementById('estadoCivilChart');
    new Chart(estadoCivilCtx, {
        type: 'bar',
        data: {
            labels: {{ estado_civil_chart.keys() | list | tojson }},
        datasets: [{
            label: 'Quantidade',
            data: {{ estado_civil_chart.values() | list | tojson }},
        backgroundColor: 'rgba(255, 99, 132, 0.7)'
            }]
        },
        options: {
        responsive: true,
        indexAxis: 'y',
        plugins: { legend: { display: false } }
    }
    });
</script>
{% endblock %}