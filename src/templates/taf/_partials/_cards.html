{% set total_rows = rows|length %}
{% set aptos = 0 %}
{% set inaptos = 0 %}
{% set sem_nota = 0 %}
{% set parciais = 0 %}

{# heurística: parcial = tem lançamentos, mas muito pouco #}
{% set limiar_parcial = 3 %}

{% for r in rows %}
{% if r.status == "APTO" %}{% set aptos = aptos + 1 %}{% endif %}
{% if r.status == "INAPTO" %}{% set inaptos = inaptos + 1 %}{% endif %}
{% if r.status == "SEM_NOTA" %}{% set sem_nota = sem_nota + 1 %}{% endif %}
{% if r.qtd_lancamentos > 0 and r.qtd_lancamentos <= limiar_parcial %} {% set parciais=parciais + 1 %} {% endif %} {%
    endfor %} <div class="row g-3 mb-3">

    <div class="col-12 col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-muted small">Militares no filtro</div>
                        <div class="h3 mb-0">{{ total_rows }}</div>
                    </div>
                    <div class="text-muted">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
                <small class="text-muted">1 linha por militar</small>
            </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-muted small">Aptos</div>
                        <div class="h3 mb-0">{{ aptos }}</div>
                    </div>
                    <div class="text-success">
                        <i class="fas fa-circle-check fa-2x"></i>
                    </div>
                </div>
                <small class="text-muted">Sem nenhum “resultado_ok = false”</small>
            </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-muted small">Inaptos</div>
                        <div class="h3 mb-0">{{ inaptos }}</div>
                    </div>
                    <div class="text-danger">
                        <i class="fas fa-triangle-exclamation fa-2x"></i>
                    </div>
                </div>
                <small class="text-muted">Existe pelo menos 1 falha</small>
            </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-muted small">Sem nota / Parciais</div>
                        <div class="h3 mb-0">{{ sem_nota }} / {{ parciais }}</div>
                    </div>
                    <div class="text-warning">
                        <i class="fas fa-hourglass-half fa-2x"></i>
                    </div>
                </div>
                <small class="text-muted">Sem lançamento / poucos lançamentos</small>
            </div>
        </div>
    </div>

    </div>