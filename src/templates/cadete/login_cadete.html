{% extends 'base.html' %}

{% block head %}
<style>
  :root {
    --overlay-alpha: .18;
    --card-alpha: .28;
    --border-alpha: .14;
    --glass-blur: 8px;
  }
  .hero-bg {
    min-height: 100vh;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    background-color: #0b0e14;
    background-image: image-set(
      url("{{ url_for('static', filename='img/bombeiros_5_1280.webp') }}") 1x,
      url("{{ url_for('static', filename='img/bombeiros_5_1920.webp') }}") 2x
    );
    position: relative;
  }
  .hero-bg::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,var(--overlay-alpha)); pointer-events: none; }
  @media (max-width: 768px){ .hero-bg{ background-image: image-set(url("{{ url_for('static', filename='img/bombeiros_5_768.webp') }}") 1x); } }

  .transparent-card{
    background: rgba(15,15,20,var(--card-alpha));
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid rgba(255,255,255,var(--border-alpha));
    box-shadow: 0 10px 40px rgba(0,0,0,.45);
    color: #e6edf3;
  }
  .transparent-card h2, .transparent-card label{ color:#f1f5f9; }
  .transparent-card .form-control, .transparent-card .form-select{
    background: rgba(255,255,255,.08);
    border-color: rgba(255,255,255,.14);
    color: #f8fafc;
  }
  .transparent-card .form-control::placeholder{ color: rgba(255,255,255,.55); }
  .transparent-card .form-control:focus{
    background: rgba(255,255,255,.12);
    border-color: rgba(99,102,241,.85);
    box-shadow: 0 0 0 .25rem rgba(99,102,241,.25);
    color:#fff;
  }
  .transparent-card .form-check-input{ background-color: rgba(255,255,255,.12); border-color: rgba(255,255,255,.25); }
  .transparent-card .form-check-input:checked{ background-color:#6366f1; border-color:#6366f1; }
  .transparent-card .btn.btn-outline-primary{ border-color: rgba(99,102,241,.85); color:#e2e8f0; }
  .transparent-card .btn.btn-outline-primary:hover{ background: rgba(99,102,241,.85); color:#0b1020; }
  .footer-note{ border-top:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06); padding:.75rem 1rem; border-bottom-left-radius:.5rem; border-bottom-right-radius:.5rem; }
  .footer-note, .footer-note a{ color:#f8fafc; }
  .footer-note a{ text-decoration: underline; font-weight:600; }
  .footer-note a:hover{ opacity:.9; }
  .badge-chip{ display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .55rem; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:.78rem; color:#e2e8f0; }
</style>
{% endblock %}

{% block body %}
<section class="py-3 py-md-4 p-xl-5 hero-bg">
  <div class="container py-3 py-md-4 p-xl-5 mt-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5">
        <div class="card border border-light-subtle rounded-3 transparent-card">
          <div class="card-body p-3 p-md-4 p-xl-5">
            <div class="text-center mb-3">
              <a href="#">
                <img src="{{ url_for('static', filename='img/logobm.png') }}" width="100" height="100" alt="Logo CBMAM">
              </a>
            </div>
            <h2 class="fs-4 fw-bold text-center mb-1">Acesso do Cadete</h2>
            <p class="text-center mb-3" style="opacity:.85;">Use seu <strong>CPF</strong> e <strong>senha</strong> do sistema. <span class="badge-chip ms-1"><i class="bi bi-shield-lock"></i> Exclusivo para posto/graduação: Aluno Oficial</span></p>

            <form method="POST" id="loginForm" novalidate>
              {{ form_login.csrf_token }}

              <div class="row gy-2 overflow-hidden">
                <div class="col-12">
                  <div class="form-group mb-2">
                    {{ form_login.cpf.label(class="form-label") }}
                    {% if form_login.cpf.errors %}
                      {{ form_login.cpf(class="form-control is-invalid", placeholder="000.000.000-00", autocomplete="username", inputmode="numeric") }}
                      <div class="invalid-feedback">
                        {% for erro in form_login.cpf.errors %}{{ erro }}{% endfor %}
                      </div>
                    {% else %}
                      {{ form_login.cpf(class="form-control", placeholder="000.000.000-00", autocomplete="username", inputmode="numeric") }}
                    {% endif %}
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-group mb-2">
                    {{ form_login.senha.label(class="form-label") }}
                    {% if form_login.senha.errors %}
                      {{ form_login.senha(class="form-control is-invalid", placeholder="Sua senha") }}
                      <div class="invalid-feedback">
                        {% for erro in form_login.senha.errors %}{{ erro }}{% endfor %}
                      </div>
                    {% else %}
                      {{ form_login.senha(class="form-control", placeholder="Sua senha", autocomplete="current-password") }}
                    {% endif %}
                  </div>
                </div>

                <div class="col-12 d-flex justify-content-between align-items-center mt-1">
                  <div class="form-check">
                    {{ form_login.lembrar_dados(class="form-check-input", id="lembrar") }}
                    <label class="form-check-label" for="lembrar">Lembrar de mim</label>
                  </div>
                  <a class="small text-decoration-underline" href="{{ url_for('login_atualizacao') }}">Área do militar</a>
                </div>

                <div class="col-12">
                  <div class="d-grid my-3">
                    {{ form_login.botao_submit_login(class="btn btn-outline-primary mt-2") }}
                  </div>
                </div>
              </div>
            </form>

            <div class="footer-note text-center mt-2">
              Dica: somente cadetes terão acesso a esta área.
            </div>
          </div>
        </div>

        <div class="text-center mt-3">
          <a class="btn btn-sm btn-outline-light" href="{{ url_for('home') }}"><i class="bi bi-house-door me-1"></i> Voltar ao início</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Máscara simples de CPF (opcional) -->
<script>
  (function(){
    const el = document.getElementById('{{ form_login.cpf.id }}');
    if(!el) return;
    el.addEventListener('input', () => {
      let v = el.value.replace(/\D/g, '').slice(0,11);
      const p1 = v.slice(0,3);
      const p2 = v.slice(3,6);
      const p3 = v.slice(6,9);
      const p4 = v.slice(9,11);
      let out = '';
      if(p1) out += p1;
      if(p2) out += '.' + p2;
      if(p3) out += '.' + p3;
      if(p4) out += '-' + p4;
      el.value = out;
    });
  })();
</script>
{% endblock %}
