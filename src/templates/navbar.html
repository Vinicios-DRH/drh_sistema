{# templates/navbar.html #}
{% from "_nav_menu.html" import render_menu %}

<nav class="navbar fixed-top navbar-glass">
    <div class="container-fluid">

        <!-- Brand -->
        <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='img/logobm.png') }}" alt="Logo CBMAM" class="brand-logo">
            <span class="brand-title d-none d-sm-inline">SIGDP</span>
        </a>

        <!-- Toggler -->
        <button id="buttonNav" class="navbar-toggler shadow-0" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Abrir menu">
            <img class="img-responsive" style="width:40px;max-width:100% !important"
                src="{{ url_for('static', filename='img/menu.png') }}" alt="Menu">
        </button>

        <!-- Offcanvas -->
        <div class="offcanvas offcanvas-end offcanvas-glass" tabindex="-1" id="offcanvasNavbar" data-bs-scroll="false">
            <div class="offcanvas-header border-bottom-0">

                <div class="d-flex align-items-center gap-2">
                    <div class="avatar-mini">
                        {{ (current_user.nome or 'U')[:1] }}
                    </div>
                    <div>
                        <a class="offcanvas-title text-decoration-none"
                            href="{{ url_for('perfil', id_usuario=current_user.id) }}">
                            <strong>{{ current_user.nome }}</strong>
                        </a>

                        <div class="small text-muted">
                            {% if current_user.obm1 %}{{ current_user.obm1.sigla }}{% endif %}
                            {% if current_user.obm2 %} · {{ current_user.obm2.sigla }}{% endif %}
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                    aria-label="Fechar"></button>
            </div>

            <div class="offcanvas-body">
                <ul class="navbar-nav menu-root">

                    {# Menu gerado no backend #}
                    {{ render_menu(nav_items or []) }}

                    {# Sair #}
                    {% if current_user.is_authenticated %}
                    <li class="nav-item mt-3">
                        <a class="btn btn-danger w-100" href="{{ url_for('sair') }}">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- Estilos -->
<style>
    :root {
        --brand-red: #B5121B;
        --brand-red-600: #9f1119;
        --glass-bg: rgba(255, 255, 255, .08);
        --glass-brd: rgba(255, 255, 255, .18);
    }

    .navbar-glass {
        background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .02));
        border-bottom: 1px solid var(--glass-brd);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
    }

    .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 6px;
    }

    .brand-title {
        font-weight: 700;
        letter-spacing: .3px;
        color: #fff;
        opacity: .9;
    }

    .navbar-toggler {
        border: 1px solid var(--glass-brd);
        background: rgba(255, 255, 255, .06);
        border-radius: 10px;
    }

    /* Offcanvas “glass” */
    .offcanvas-glass {
        background: linear-gradient(135deg, rgba(15, 25, 40, .96), rgba(8, 18, 32, .96));
        color: #e8eef6;
        border-left: 1px solid var(--glass-brd);
    }

    .offcanvas-glass .offcanvas-title {
        color: #fff;
    }

    .offcanvas-glass .nav-link {
        color: #e8eef6;
        border-radius: 10px;
        padding: .55rem .75rem;
    }

    .offcanvas-glass .nav-link:hover {
        background: rgba(255, 255, 255, .06);
    }

    .offcanvas-glass .dropdown-menu {
        border: 1px solid var(--glass-brd);
    }

    .dropdown-glass {
        background: rgba(20, 30, 46, .98);
        color: #e8eef6;
        border-radius: 12px;
        overflow: hidden;
    }

    .dropdown-glass .dropdown-item {
        color: #e8eef6;
    }

    .dropdown-glass .dropdown-item:hover {
        background: rgba(255, 255, 255, .06);
    }

    .menu-root {
        padding-top: 6px;
    }

    .menu-root .nav-item {
        margin-bottom: 6px;
    }

    .avatar-mini {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        background: rgba(255, 255, 255, .08);
        border: 1px solid var(--glass-brd);
        font-weight: 700;
    }
</style>

<style>
    /* Largura do painel (Bootstrap usa essa custom prop) */
    #offcanvasNavbar {
        --bs-offcanvas-width: min(92vw, 380px);
    }

    /* Offcanvas ocupa a viewport toda e vira flex col */
    .offcanvas-glass {
        height: 100vh;
        height: 100dvh;
        display: flex;
        flex-direction: column;
    }

    /* Header não cresce, body cresce e rola */
    .offcanvas-glass .offcanvas-header {
        flex: 0 0 auto;
    }

    .offcanvas-glass .offcanvas-body {
        flex: 1 1 auto;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: .75rem;
    }

    .offcanvas-glass .menu-root {
        max-height: none;
    }
</style>