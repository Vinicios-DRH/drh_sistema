{% set user_funcao = current_user.funcao_user_id %}
{% set user_obm = current_user.obm1.sigla if current_user.obm1 else '' %}

<nav class="navbar fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='img/logobm.png') }}" alt="Logo" style="width:30px; height:auto;">
        </a>
        <button id="buttonNav" class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <img class="img-responsive" style="width:40px; max-width:100% !important;"
                src="{{ url_for('static', filename='img/menu.png') }}" alt="">
        </button>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title">Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
            </div>

            <div class="offcanvas-body">
                <div class="mb-3">
                    <div>
                        <a href="{{ url_for('perfil', id_usuario=current_user.id) }}"><strong class="offcanvas-title">{{
                                current_user.nome }}</strong></a>
                    </div>

                    <small class="text-muted">
                        {% if current_user.obm1 %}{{ current_user.obm1.sigla }}{% endif %}
                        {% if current_user.obm2 %} - {{ current_user.obm2.sigla }}{% endif %}
                    </small>
                </div>

                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('home') }}">
                            <i class="fas fa-home me-2"></i> In√≠cio
                        </a>
                    </li>

                    <!-- <li class="nav-item">
                        {% if militar_id_atual %}
                        <a class="nav-link" href="{{ url_for('acumulo.novo', militar_id=militar_id_atual) }}">
                            <i class="fas fa-user me-2"></i> Declara√ß√£o de V√≠nculo
                        </a>
                        {% else %}
                        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">
                            <i class="fas fa-user me-2"></i> Declara√ß√£o de V√≠nculo
                        </a>
                        {% endif %}
                    </li> -->

                    {# ---- Declara√ß√µes de V√≠nculo (Ac√∫mulo) ---- #}
                    {% set ocup = (current_user.funcao_user.ocupacao or '').upper() if current_user.funcao_user else ''
                    %}
                    {% set is_super = 'SUPER' in ocup %}
                    {% set is_drh = 'DRH' in ocup %} {# casa DRH, DIRETOR DRH, DRH CHEFE, CHEFE DRH... #}
                    {% set is_chefe_ou_diretor_obm = ('CHEFE' in ocup or 'DIRETOR' in ocup) and not is_drh and not
                    is_super %}

                    {% if is_chefe_ou_diretor_obm %}
                    {# Chefes/Diretores de OBM: somente a lista #}
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="{{ url_for('acumulo.lista') }}">
                            <i class="fas fa-file-signature me-2"></i> Declara√ß√µes de V√≠nculo
                        </a> -->
                    </li>
                    {% elif is_drh or is_super %}
                    {# DRH (qualquer varia√ß√£o) e SUPER USER: lista + recebimento #}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-file-signature me-2"></i> Declara√ß√µes de V√≠nculo
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('acumulo.lista') }}">üìã Lista</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('acumulo.recebimento') }}">‚úÖ Recebimento</a>
                            </li>
                        </ul>
                    </li>
                    {% endif %}

                    {# Se o usu√°rio √© da OBM DRH ou SUPER USER #}
                    {% if user_funcao in [5, 6, 7] %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-id-card me-2"></i> Documenta√ß√£o
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('gerar_le') }}">üìÑ Licen√ßa Especial</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('indeferimento_le') }}">üìÑ Indeferida Licen√ßa
                                    Especial</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('gerar_lp') }}">üìÑ Licen√ßa Paternidade</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('gerar_certidao_casamento') }}">üìÑ Certid√£o de
                                    Casamento</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('gerar_certidao_obito') }}">üìÑ Certid√£o de
                                    √ìbito</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-friends me-2"></i> Militares Ativos
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('militares') }}">üë• Mapa da For√ßa</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_militar') }}">‚ûï Adicionar
                                    Militar</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('militares_a_disposicao') }}">üîÑ Militares a
                                    disposi√ß√£o</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('militares_agregados') }}">‚ûñ Militares
                                    agregados</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('licenca_especial') }}">üóìÔ∏è Licen√ßa
                                    Especial</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('lts') }}">üè• Licen√ßa para Tratamento de
                                    Sa√∫de</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('gerar_qrcodes') }}"> Óáò Gerar QrCodes</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-friends me-2"></i> Militares Inativos
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('listar_militares_inativos') }}">üë• Mapa da
                                    For√ßa Inativos</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_militar_inativo') }}">‚ûï Adicionar
                                    Militar Inativo</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-id-card me-2"></i> Motoristas
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_motorista') }}">‚ûï Adicionar
                                    Motorista</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('motoristas') }}">üìç Mapa Motoristas</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_cnhs') }}">üìÑ Listar CNHs</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('escolher_obm') }}">üöó Viaturas</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-dollar-sign me-2"></i> Pagadoria
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('novo_vencimento') }}">üìù Nova Tabela de
                                    Vencimentos</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('calcular_impacto') }}">üìà C√°lculo de
                                    Impacto</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-id-card me-2"></i> Convoca√ß√£o Concurso
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('relatorio_convocacao') }}">üìÑ Relat√≥rio
                                    Convoca√ß√£o </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_convocacao') }}">‚ûï Adicionar
                                    Convocado</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('importar_convocados') }}">‚ûï Importar
                                    Convocados</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('controle_convocacao') }}">üìÑ Controle
                                    Convocacao</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('dashboard') }}">üìà Dashboard</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    {% set funcao = current_user.funcao_user_id %}
                    {% set obm = current_user.obm_id_1 %}

                    {% if (funcao == 2 and obm == 26) or funcao == 6 %}
                    <!-- ACESSO TOTAL -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-graduate me-2"></i> Alunos Soldados
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('ficha_aluno') }}">‚ûï Nova Ficha</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_fichas') }}">üìÑ Ver Fichas</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_alunos_inativos') }}">üìÑ Ver Alunos
                                    Inativos</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_alunos_em_lts') }}">üìÑ Ver Alunos
                                    em LTS</a>
                            </li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('listar_por_pelotao', slug='rio-javari') }}">üìä Pelot√£o Rio
                                    Javari</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_por_pelotao', slug='rio-jurua') }}">üìä
                                    Pelot√£o Rio
                                    Juru√°</a></li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('listar_por_pelotao', slug='rio-japura') }}">üìä Pelot√£o Rio
                                    Japur√°</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_por_pelotao', slug='rio-purus') }}">üìä
                                    Pelot√£o Rio
                                    Purus</a></li>
                        </ul>
                    </li>

                    {% elif funcao == 8 %}
                    <!-- Monitor JAVARI -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('listar_por_pelotao', slug='rio-javari') }}">üìä Pelot√£o
                            Rio Javari</a>
                    </li>

                    {% elif funcao == 9 %}
                    <!-- Monitor JURU√Å -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('listar_por_pelotao', slug='rio-jurua') }}">üìä Pelot√£o
                            Rio Juru√°</a>
                    </li>

                    {% elif funcao == 10 %}
                    <!-- Monitor JAPUR√Å -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('listar_por_pelotao', slug='rio-japura') }}">üìä Pelot√£o
                            Rio Japur√°</a>
                    </li>

                    {% elif funcao == 11 %}
                    <!-- Monitor PURUS -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('listar_por_pelotao', slug='rio-purus') }}">üìä Pelot√£o
                            Rio Purus</a>
                    </li>
                    {% endif %}

                    {% if user_funcao == 6 %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-tools me-2"></i> Utilidades
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('usuarios') }}">üë§ Usu√°rios</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('criar_conta') }}">‚ûï Adicionar Usu√°rio</a>
                        </ul>
                    </li>
                    {% endif %}

                    {# Acesso √†s F√©rias separado conforme perfil #}
                    {% if user_funcao in [1, 2, 7] %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('exibir_ferias_chefe') }}">F√©rias</a>
                    </li>
                    {% endif %}

                    {% if user_funcao == 6 %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('exibir_ferias') }}">F√©rias</a>
                    </li>
                    {% endif %}

                    {# Bot√£o de sair #}
                    {% if current_user.is_authenticated %}
                    <li class="nav-item mt-3">
                        <a class="btn btn-danger w-100" href="{{ url_for('sair') }}">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- Estilos Extras para deixar o Offcanvas mais bonito -->
<style>
    .offcanvas-body ul.navbar-nav {
        padding-top: 15px;
    }

    .offcanvas-body li.nav-item {
        margin-bottom: 10px;
    }
</style>