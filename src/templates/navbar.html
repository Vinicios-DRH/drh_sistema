{% set user_funcao = current_user.funcao_user_id %}
{% set user_obm = current_user.obm1.sigla if current_user.obm1 else '' %}

<nav class="navbar fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='img/logobm.png') }}" alt="Logo" style="width:30px; height:auto;">
        </a>
        <button id="buttonNav" class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <img class="img-responsive" style="width:40px; max-width:100% !important;"
                src="{{ url_for('static', filename='img/menu.png') }}" alt="">
        </button>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title">Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
            </div>

            <div class="offcanvas-body">
                <div class="mb-3">
                    <div>
                        <a href="{{ url_for('perfil', id_usuario=current_user.id) }}"><strong class="offcanvas-title">{{
                                current_user.nome }}</strong></a>
                    </div>

                    <small class="text-muted">
                        {% if current_user.obm1 %}{{ current_user.obm1.sigla }}{% endif %}
                        {% if current_user.obm2 %} - {{ current_user.obm2.sigla }}{% endif %}
                    </small>
                </div>

                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('home') }}">
                            <i class="fas fa-home me-2"></i> In√≠cio
                        </a>
                    </li>

                    {# Se o usu√°rio √© da OBM DRH ou SUPER USER #}
                    {% if user_funcao in [5, 6, 7] %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-friends me-2"></i> Militares Ativos
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('militares') }}">üë• Mapa da For√ßa</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_militar') }}">‚ûï Adicionar
                                    Militar</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('militares_a_disposicao') }}">üîÑ Militares a
                                    disposi√ß√£o</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('militares_agregados') }}">‚ûñ Militares
                                    agregados</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('licenca_especial') }}">üóìÔ∏è Licen√ßa
                                    Especial</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('lts') }}">üè• Licen√ßa para Tratamento de
                                    Sa√∫de</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('gerar_qrcodes') }}"> Óáò Gerar QrCodes</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-id-card me-2"></i> Motoristas
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_motorista') }}">‚ûï Adicionar
                                    Motorista</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('motoristas') }}">üìç Mapa Motoristas</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_cnhs') }}">üìÑ Listar CNHs</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-dollar-sign me-2"></i> Pagadoria
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('novo_vencimento') }}">üìù Nova Tabela de
                                    Vencimentos</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('calcular_impacto') }}">üìà C√°lculo de
                                    Impacto</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-id-card me-2"></i> Convoca√ß√£o Concurso
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('relatorio_convocacao') }}">üìÑ Relat√≥rio
                                    Convoca√ß√£o </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('adicionar_convocacao') }}">‚ûï Adicionar
                                    Convocado</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('importar_convocados') }}">‚ûï Importar
                                    Convocados</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('controle_convocacao') }}">üìÑ Controle
                                    Convocacao</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('dashboard') }}">üìà Dashboard</a></li>
                        </ul>
                    </li>
                    {% endif %}

                    {% if user_funcao in [5, 6, 7, 8] %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-graduate me-2"></i> Alunos Soldados
                        </a>

                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('ficha_aluno') }}">‚ûï Nova Ficha</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_fichas') }}">üìÑ Ver Fichas</a></li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('listar_por_pelotao', slug='rio-javari') }}">üìä Pelot√£o Rio
                                    Javari</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_por_pelotao', slug='rio-jurua') }}">üìä
                                    Pelot√£o Rio
                                    Juru√°</a></li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('listar_por_pelotao', slug='rio-japura') }}">üìä Pelot√£o Rio
                                    Japur√°</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('listar_por_pelotao', slug='rio-purus') }}">üìä
                                    Pelot√£o Rio
                                    Purus</a></li>
                        </ul>
                    </li>
                    {% endif %}

                    {% if user_funcao == 6 %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-tools me-2"></i> Utilidades
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('usuarios') }}">üë§ Usu√°rios</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('criar_conta') }}">‚ûï Adicionar Usu√°rio</a>
                        </ul>
                    </li>
                    {% endif %}

                    {# Acesso √†s F√©rias separado conforme perfil #}
                    {% if user_funcao in [1, 2, 7] %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('exibir_ferias_chefe') }}">F√©rias</a>
                    </li>
                    {% endif %}

                    {% if user_funcao == 6 %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('exibir_ferias') }}">F√©rias</a>
                    </li>
                    {% endif %}

                    {# Bot√£o de sair #}
                    {% if current_user.is_authenticated %}
                    <li class="nav-item mt-3">
                        <a class="btn btn-danger w-100" href="{{ url_for('sair') }}">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- Estilos Extras para deixar o Offcanvas mais bonito -->
<style>
    .offcanvas-body ul.navbar-nav {
        padding-top: 15px;
    }

    .offcanvas-body li.nav-item {
        margin-bottom: 10px;
    }
</style>